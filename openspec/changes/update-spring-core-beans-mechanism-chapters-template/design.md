# Design: Heavy template for mechanism deep-dive docs (source anchors + breakpoint loop + layer triage)

## Goal

让 `spring-core-beans/docs` 的“机制深潜章”从“概念理解”升级为“可追踪的机制学习”：

- 学习者能快速找到**源码入口**（关键类/关键方法）
- 学习者能跟随**断点闭环**用现有 Lab/Test 在 30 分钟内验证结论
- 学习者遇到常见症状时能用**定义层 vs 实例层**分流进行排障定位

## Non-Goals

- 不把文档变成 Spring 源码精读（不贴大段源码，不追求覆盖所有分支）
- 不引入新的 Labs/Exercises（本变更仅改文档）
- 不强制每章写成统一的“长文模板”（只要求补齐固定块，避免侵入性）

## In-Scope Chapters

“机制深潜章”定义为 `spring-core-beans/docs/12-*.md` … `34-*.md`（不含 `90/99`）。

这些章节的共同点是：

- 讨论容器内部阶段、扩展点、缓存、代理、解析顺序等“机制型问题”
- 与“断点 + 测试”学习方式天然契合

## Template (Heavy)

每个机制深潜章节在保留原有结构的基础上，追加一个固定的模板块。推荐放置位置：

- 放在“常见坑”之前；若章节已以“常见坑 → 自检”结尾，则放在“常见坑”前一节

### 1) `## 源码锚点（建议从这里下断点）`

**目的**：把本章机制映射到可跳转的关键点，解决“我知道概念，但不知道该去哪看”的问题。

**要求（重度）**：

- 至少 3–5 个锚点
- 以“类#方法”级别为主（可附 1 行说明“为什么看这里”）
- 尽量选择稳定的主流程方法（跨版本更不容易漂移）
- 若锚点过深（容易误导初学者），允许标记为“进阶（可选）”

**示例格式（说明用，非要求逐字照抄）**：

- `AbstractApplicationContext#refresh`：看容器阶段划分
- `PostProcessorRegistrationDelegate#registerBeanPostProcessors`：看 BPP 注册与排序
- `AbstractAutowireCapableBeanFactory#doCreateBean`：看“一个 bean 如何诞生”

### 2) `## 断点闭环（用本仓库 Lab/Test 跑一遍）`

**目的**：把本章结论落到“可运行的复现路径”，形成从现象到机制的闭环。

**要求（重度）**：

- 至少指向 1 个现有 `*LabTest`（写出文件路径；必要时指出具体测试方法名）
- 给出一个建议运行方式（例如只跑单个 test class，避免全量噪音）
- 列出推荐断点（通常 3–6 个），并写出每个断点“你应该看到什么”
- 若该章已有 `OBSERVE:` 输出，也应说明“观察点来自哪里/应该对齐什么”

**建议约束**：

- 避免要求学习者单步穿过过深的内部逻辑（强调“看阶段/看关键分支”即可）
- 断点优先放在 Spring 核心入口 + 本仓库自定义的 probe/processor 上

### 3) `## 排障分流：这是定义层问题还是实例层问题？`

**目的**：把 `docs/01` 的三层模型落到实战定位路径，减少“盲猜/玄学”。

**要求**：

- 至少给出 3 类常见症状的分流建议
- 每类症状明确：优先检查定义层/实例层/两者都可能
- 链接回“更通用的定位章节”（例如 `docs/00`、`docs/11`、`docs/03` 等）或本章对应的 Lab/Test

**建议症状类型（可按章节取子集）**：

- “bean 没注册/找不到” → 定义层（扫描/`@Import`/条件/顺序）
- “注入选错候选/候选太多” → 实例层的依赖解析路径（但定义层元数据也可能参与）
- “拿到的是 proxy/类型不匹配” → 实例层（BPP/短路/early reference）

## How this stays consistent with existing docs

现有章节大多遵循：现象 → 机制解释 → 常见坑 → 自检。模板的加入是“补齐可执行入口”，并不替换原叙述方式。

实现时的优先级建议：

1) 先补齐模板块（让所有机制章具备同一套入口）
2) 再在必要处做少量交叉链接（例如引用 `docs/00` 作为通用源码导航）

