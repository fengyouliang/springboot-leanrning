# 迁移规则（合并/拆章/redirect/断链）

本页目标：在允许大规模重排与改名的前提下，让“书籍化迁移”仍然可控、可回滚、可验收。

---

## 书籍化迁移的核心原则

1. **先稳定目录与阅读入口**：先让读者“顺读得下去”，再做物理迁移与章节重排。
2. **证据链不丢**：迁移后仍要能定位到可跑入口（Lab/Exercise/Solution）与可观察点（断点/关键分支）。
3. **少量关键入口可保留 redirect**：不是为了“永远兼容”，而是为了避免站内导航/搜索/历史链接瞬间失效。

---

## 什么时候应该“移动文件”

建议移动/合并/拆章的场景：

- 同一机制跨模块重复出现，且更适合放进书的叙事主线中
- 某章节天然是“跨模块桥接章节”（例如：AOP → Tx → Web 的承接）
- 模块目录结构已经成为阅读负担（读者先要理解目录才能开始读）

---

## 什么时候应该“保留 redirect（旧入口）”

建议保留 redirect 的场景：

- 模块 README/站点首页/书目录等关键入口已广泛引用
- 章节在历史版本/外部笔记中被大量引用
- 该章节本身承担“可跑入口”的聚合索引（迁移后容易让读者找不到实验入口）

redirect 页面建议至少保留：

- 1–2 句说明（发生了什么迁移）
- 指向新章节的链接
- （可选但推荐）保留一个可跑入口类名（避免“迁移后章节不再可运行”）

---

## 什么时候允许断链

允许断链的场景（低成本清理）：

- 章节属于“重复内容/临时笔记/历史草稿”
- 章节不再出现在书目录与模块 README 的主线入口中

即便允许断链，也建议：

- 在一次迁移批次里跑 `bash scripts/check-docs.sh` 与 `bash scripts/docs-site-build.sh`

