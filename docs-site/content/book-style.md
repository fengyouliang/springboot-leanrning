# 写作指南：把文档写成“书”

本仓库的模块文档目标不是“参考手册式罗列”，而是**像一本书一样可以顺读**：读者能从一个入口开始，沿着主线把机制与源码跑通；需要深入时，再用索引去定位细节章节。

---

## 1. 本仓库的书籍化原则

1. **主线先行**：每个模块都要有“主线时间线”章节，回答“这一套机制在容器/框架里按时间顺序怎么发生”。
2. **叙事优先，结构服务叙事**：不采用固定 7 段契约式骨架；“机制/源码/实验/排障”以插入段的形式出现。
3. **入口稳定**：尽量不移动文件路径；必要的合并/拆章使用“redirect 页面”保留旧入口。
4. **读者闭环**：重要章节要能落到可运行的 Lab/Test 或可观察的断点/日志，让读者能验证理解而不是“背概念”。

## 2. 推荐的章节写法（不强制，但强烈建议）

### 2.0 章节学习卡片（强烈建议，推荐作为“第一屏”）

为了让每一章都能回答“我在学什么/怎么用/为什么/去哪看源码/怎么验证”，建议在每章标题后放置一个 **章节学习卡片（五问闭环）**：

- **知识点是什么**：一句话定义边界（本章解决什么问题）
- **怎么使用**：给出最常见的用法与落地步骤（注解/配置/调用方式）
- **原理是什么**：给出主线与关键分支（调用链/生命周期/拦截链/时机差异）
- **源码入口是什么**：给出关键类/关键方法/建议断点（Spring/Spring Boot + 本仓库对照）
- **哪个 Lab 能加深理解**：给出至少 1 个可跑 Lab/Test（最好能一条命令跑起来）

推荐格式（MkDocs admonition）：

- `!!! summary`：章节学习卡片（五问闭环）
- 其中 5 条使用同一套字段名，便于自动化检查与批量维护

### 2.1 章首提示框（可选）

- `!!! summary`：本章最重要的 2–3 个结论（读者能复述）
- `!!! example`：建议先跑的实验入口（方法级/测试级优先）

### 2.2 叙事中的插入段（按需出现）

- `!!! note`：源码锚点（关键类/关键方法/关键分支）
- `!!! info`：Debugger Pack（Entrypoints / Watchpoints / Decisive Branch）
- `!!! warning`：坑点与边界（最常见误区 + 如何验证/规避）

> 关键点：提示框是“插入段”，不是固定并列模板；叙事主线应当可连续阅读。

### 2.3 正文二次书籍化（第二层：让每一章都更像“书”）

当章节完成“第一层书籍化”（卡片/要点/实验入口提示框齐全）后，仍可能出现“读起来像文档”的问题：开场不一致、推进节奏跳跃、结尾没有承接、跑完实验不知道该看什么。

建议对正文做一次“二次书籍化”，把每章叙事节奏稳定下来：

1. **导读**：先交代“本章解决什么问题/为什么现在需要它/怎么读这一章”，再进入机制细节。
2. **主线推进**：用时间线/调用链把机制串起来（从入口到关键分支），避免碎片化罗列。
3. **关键分支/坑点**：把读者最容易踩的 2–4 个分支/边界讲清楚，并给出“如何验证你踩到了它”的证据提示。
4. **证据链**：把“建议观察什么/在哪下断点/如何断言结论”写成可执行的提示，避免“跑了但不知道看什么”。
5. **小结与下一章承接**：收束到一段可复述的总结，并告诉读者下一章怎么接（优先复用页尾导航）。

#### 2.3.1 证据链怎么写（强烈建议）

每章建议给出 **2–4 条证据链提示**，每条包含三要素：

- **观察点**：跑 Lab/读日志时你要“盯住”的现象（顺序/覆盖/回滚/异常传播/SQL/线程切换等）
- **断点/入口**：推荐断点（类/方法/关键分支），或至少给出源码入口
- **断言**：你应该能复述的结论（“为什么会这样/在什么条件下不会这样”）

> 原则：证据链写法应以“章节学习卡片（五问闭环）”为事实来源，不要凭空添加细节；尽量用“建议/推荐/可验证”的语气，避免写成不确定的断言。

#### 2.3.2 最小可复用模板片段（示例）

普通章节（建议）：

```md
## 导读

## 主线推进

## 关键分支与坑点

## 证据链（如何验证你真的理解了）
- 观察点：
- 断点：
- 断言：

## 小结与下一章
```

redirect 页（最小模板，避免噪音）：

```md
## 已迁移
本页为旧入口兼容页，正文已迁移到：[新位置](...)
```

工具页/索引页（最小模板，允许 N/A）：

```md
## 怎么用这页
把“入口/索引/实验/断点地图”讲清楚：先跑什么、去哪看、怎么回到主线顺读。
```

#### 2.3.3 常见反例（以及如何修复）

- **空块/空标题**：例如 `## 一句话总结` 为空 → 要么补齐一句可复述总结，要么删除该空标题（推荐补齐）。
- **重复实验入口**：章首已有 `!!! example`，正文又重复贴一遍同样的 Lab/Test 清单 → 正文保留“怎么跑/观察什么”，清单只保留一处入口。
- **redirect 页被扩写**：旧入口页写成了正文 → 改回最小说明 + 新位置链接 + 导航，避免读者在旧页分叉迷路。

## 3. 每个模块 README（目录页）应长什么样

`<module>/docs/README.md` 是读者的第一入口，建议满足三件事：

1. **第一屏告诉读者从哪开始读**（主线时间线 / 30 分钟快速闭环）
2. **给出顺读主线的目录**（按时间线）
3. **给出深挖索引与排障入口**（按机制域/症状）

## 4. 链接稳定与重排策略

- **优先保留路径**：只重写内容与目录组织，不随意移动文件。
- **需要合并/拆章时**：
  - 新章节承载内容（保持“顺读”更自然）
  - 旧章节改为 redirect 页面（保留标题 + 1–2 句说明 + 指向新章节链接）

## 5. 写作风格建议（让它更像书）

- 先给读者“为什么需要这一步”的上下文，再进入机制细节
- 用具体场景串起来（例如：一个请求如何从入口一路走到关键扩展点）
- 避免“术语堆叠式概述”；遇到概念时要落到一个可观察证据（源码/日志/断点/测试）
