# 怎么做：全模块书籍化重写方案

## 总体策略（分两层推进）

### 第一层：全量“去契约化”迁移（自动化，覆盖所有章节）

目标：先把“ABCD…”从读者视线中消失，并把“要点/Lab 入口”变成书籍常见的“提示框/侧栏”。

执行动作：

- 移除 `AG-CONTRACT` 标记（不再把正文视为“契约块”）
- 统一去掉 `## A.`～`## G.` 的字母前缀
- 将“核心结论”改为 **summary 提示框**（更像书的“本章要点”）
- 将 `BOOKIFY` 尾部块中的 `Lab/Test` 信息提炼为 **章首提示框**（读者可以先跑再读）

这一步以“自动化可重复执行”为主，保证全仓快速一致。

### 第二层：主线时间线重排（人工为主，逐模块分批）

目标：按机制主线把“短章合并、长章拆分、顺序重排”，形成真正可顺读的“书”。

执行动作（每个模块）：

- 为每个 Part 增加 **主线章节（Timeline Chapter）**：用 1 章讲清楚这一 Part 的时间线与关键决策点
- 识别并合并碎片章节：把“同一条主线的多段”收敛成连续叙事
- 识别并拆分超长章节：把“不同主题/不同分支”拆分为并列小章（但保持顺读）
- 将源码/实验/排障以“插入段/侧栏”出现：
  - 源码锚点：`tip`/`note` 侧栏
  - 实验入口：`example` 侧栏（方法级命令/测试类）
  - Debugger Pack：`info` 侧栏（entrypoints/watchpoints/decisive branch）
  - 坑点与边界：`warning` 侧栏（最常见误区 + 如何验证）

## 风险控制

- 不做“一次性大规模移动文件路径”：先完成写作形态迁移，再进入重排/合并/拆章
- 每批次改动都必须通过：
  - `bash scripts/check-docs.sh`
  - `bash scripts/docs-site-build.sh`

