# Change Proposal: 全站文档升级为“全书统一章节”（章节顺序 + 模块顺序）

## Requirement Background

当前仓库已经具备“像读书一样学”的雏形：

- `docs-site/content/book/` 提供了 0–18 的主线章节（跨模块串联）。
- 各模块 `*/docs/README.md` 提供了模块内的推荐阅读顺序与章节清单（并作为自检脚本的 SSOT）。
- 每章已补齐“章节学习卡片（五问闭环）”，保证第一屏回答：知识点 / 怎么使用 / 原理 / 源码入口 / 推荐 Lab。

但阅读体验仍存在关键断裂：

1) “书”与“模块文档”是两套体系：MkDocs 侧边栏只展示 Book-only 主线，模块 docs 主要靠搜索或手动跳转；  
2) 每个 `.md` 虽然是一个“文档”，但在全站范围内缺少明确的“章节顺序”（上一章/下一章不连续、跨模块不连贯）；  
3) 模块顺序未被系统化地固化到站点导航、模块总览页、根 README、以及各模块目录页中。

你希望实现的目标是：**把全站所有 doc 都当成一本书里的章节**，并给出“最合理、最佳的 Spring 学习顺序”，同时在以下入口全部体现：

- (A) 站点侧边栏（MkDocs nav）
- (B) 模块总览页（`modules/index.md`）
- (C) 根 `README.md`
- (D) 各模块 `docs/README.md`

## Change Content

1. **全书统一章节顺序（Global TOC）**：定义“最合理的学习路径”作为全站章节顺序基线（模块顺序 + 模块内章节顺序）。
2. **全书统一章节号（Chapter ID）**：为每个章节分配全局唯一的章节号，并固化到文件名/导航标题/页面内导航中，使“一个 doc 就是一章”在仓库层面可感知、可排序。
2. **章节自成顺序**：为每个章节生成全书层面的“上一章 / 目录 / 下一章”导航，让读者可以从任意一章开始顺读到底。
3. **模块顺序显式化**：在 A/B/C/D 四个入口中一致展示“推荐模块顺序”，并提供前后模块跳转与“本模块在全书的位置”说明。
4. **可维护与可重复执行**：顺序与导航由脚本生成（idempotent），避免人工维护导致顺序漂移或漏章。

## Impact Scope

- **Modules:** 覆盖全部 18 个模块（所有存在 `docs/README.md` 的模块）。
- **Files:** 涉及全量章节（当前约 198 个 Markdown 页面：模块章节 + Book-only 页面）。
- **APIs:** 无对外 API 变更（文档站与脚本行为变更）。
- **Data:** 无数据模型变更。

## Core Scenarios

### Requirement: 全站任何一章都能顺读到底
**Module:** docs-site / 全模块 docs
读者从任意 `.md` 章节进入（例如 `docs-site/content/book/02-ioc-container-mainline.md` 或某个模块内部章节），可以沿着“上一章/下一章”一路读下去，不需要靠搜索或返回目录反复找路。

#### Scenario: 从主线章节进入再深入模块细节
在主线章节后可以无缝进入对应模块的“深挖章节序列”，然后再回到下一模块的主线节点。
- 预期：学习路径连续、不会断层

#### Scenario: 从模块章节进入也能回到全书目录
读者从模块 docs 里任意章节进入，也能一键回到“全书目录（Global TOC）”，并知道该章位于哪一模块、哪一段学习路径。
- 预期：入口稳定、定位明确

### Requirement: 模块顺序在四处一致
**Module:** docs-site / README / modules index / module docs

#### Scenario: 四处展示同一份模块顺序
站点 nav、模块总览页、根 README、模块目录页展示一致的模块顺序（同一份推荐学习路径）。
- 预期：用户不被“不同入口不同顺序”困扰

## Risk Assessment

- **Risk:** 大规模文档重命名/导航与顺序改造可能引入断链、重复章节、顺序漂移，影响现有自检脚本与站点构建。
- **Mitigation:**
  - 先生成“旧路径 → 新路径”的映射表，再批量重命名与重写链接，最后用断链闸门做回归；
  - 以脚本生成全书顺序，并接入闸门（`scripts/check-docs.sh` + `mkdocs build --strict`）做回归；
  - 保留模块 `docs/README.md` 作为模块章节 SSOT，不破坏教学化覆盖自检；
  - 导航块使用稳定 marker（可幂等 upsert），避免多次运行叠加污染正文。
