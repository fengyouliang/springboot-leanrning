# Change Proposal: 全站文档深度书籍化改写（全部章节）

## Requirement Background

当前仓库已经具备“像书一样可顺读”的基础设施：

1. 全书目录与章节顺序（分卷→模块→章节）已固化为 SSOT（`scripts/book-order.json`）。
2. 全站章节已覆盖“章节学习卡片（五问闭环）”（知识点/怎么使用/原理/源码入口/推荐 Lab）。
3. 全站章节已覆盖“上一章｜全书目录｜下一章”导航，并有闸门校验（断链/卡片/覆盖度/站点 strict build）。

但在实际阅读体验上，仍存在典型“像文档而不像书”的问题：

- 章节叙事不一致：同类型章节的开场方式、推进节奏、收束方式差异大，读者难以形成稳定预期。
- 冗余与模板残留：部分章节存在重复段落（多处实验入口/多处总结），或出现空标题（例如“## 一句话总结”为空）。
- 证据链表达不统一：虽然有推荐 Lab，但“要观察什么/如何验证结论”的写法不一致，导致读者跑完也不知道该看什么。

本次改造目标：在不牺牲技术准确性的前提下，把“全量章节”的正文统一提升为**更像书籍章节的叙事与验证闭环**。

---

## Change Content

1. 定义并固化“章节正文二次书籍化”写作规范：统一叙事节奏（导读→主线→关键分支→证据链→收束承接），并明确哪些内容以卡片为 SSOT。
2. 引入可重复执行的批处理脚本：对全量章节做结构整理与内容收束（去冗余、补空块、把证据链写清楚），并保证幂等。
3. 对 Book 与模块 docs 统一执行：覆盖 18 个模块的全部章节 + `docs/book/**`（含工具页/redirect 页）。

---

## Impact Scope

- **Modules:** 18 个模块（全部包含 `docs/README.md` 的模块）+ `docs-site`
- **Files:** 全量章节 Markdown（规模级变更）+ 1 个批处理脚本 + 可能的写作指南与自检脚本
- **APIs:** N/A（文档改造）
- **Data:** N/A

---

## Core Scenarios

### Requirement: 全量章节读起来像“书”
**Module:** docs-site + all modules
让任意一章都具备“开场问题→机制主线→验证证据→下一章承接”的可连续阅读体验。

#### Scenario: 顺读不迷路
读者从任意章节进入（书章节或模块章节），都能用导航顺读到底，并在关键结论处找到可跑入口。
- 预期：章节开场有上下文；章节结尾明确“下一章怎么接”；导航与链接不破坏。

#### Scenario: 跑完实验知道看什么
读者按建议运行推荐 Lab 后，能明确观测点（线程/异常传播/顺序/SQL 等）并理解结论。
- 预期：每章至少给出 2–4 条“观察点/断点/断言”提示，避免“跑了但不知道验证了什么”。

### Requirement: 结构一致且无空块/模板残留
**Module:** docs-site + all modules
批处理后消除“空标题/重复入口/模板化空段落”，让章节结构稳定、信息密度更像书。

#### Scenario: 章节结构可预期
同类型章节（主线/坑点/自测/导读）在第一屏和正文结构上具备一致性。
- 预期：保留五问卡片；正文至少包含导读与证据链表达；空块清零。

---

## Risk Assessment

- **Risk:** 批量改写导致断链或站点构建失败（大量文件改动）
  - **Mitigation:** 强制执行 `bash scripts/check-docs.sh` + `bash scripts/docs-site-build.sh`；脚本幂等；必要时对少量异常章节做手工修复。
- **Risk:** 批处理生成“正确但空泛”的段落，降低技术准确性
  - **Mitigation:** 以“章节学习卡片”为事实来源（不凭空编造机制细节）；对高价值主线章做人工抽样精修；保留原有技术段落并避免错误重写。

